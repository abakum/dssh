# dssh

dssh:=(tssh from trzsz)+(CA key with embed-encrypt)+(sshd from gliderlabs)+(access over NAT using jumphost ssh-j.com)+(ser2net with putty or direct connect to serial console or over browser)

# 0. Мои благодарности<div id=0.1>
1. [Lonny Wong](https://github.com/trzsz/trzsz-ssh).<div id=0.2>
2. [Paul Scheduikat](https://github.com/lu4p/embed-encrypt).<div id=0.3>
3. [Glider Labs](https://github.com/gliderlabs/ssh).<div id=0.4>
4. [ValdikSS](https://bitbucket.org/ValdikSS/dropbear-sshj/src/master).<div id=0.5>
5. [9elements](https://github.com/9elements/go-ser2net).<div id=0.6>
6. [Patrick Rudolph](https://github.com/PatrickRudolph/telnet).<div id=0.7>
7. [Simon Tatham](https://www.chiark.greenend.org.uk/~sgtatham/putty).<div id=0.8>
8. [Corey Minyard](https://github.com/cminyard/ser2net).<div id=0.9>
9. [Vyacheslav Frolov](https://sourceforge.net/projects/com0com/files/hub4com/2.1.0.0/).<div id=0.10>
10. [MikroTik](https://help.mikrotik.com/docs/).

# 1. Как использовать для доступа к локальной консоли:<div id=1.1>
- y. отсутствует зачит локальная последовательная консоль на первом свободном порту USB. Или путь к последовательному порту на Linux как /dev/ttyUSB0. Или последовательный порт на Windows как COM1. Или суффикс порта от 0 до 9.
- X. IP или dns адрес или ssh-алиас или dssh-алиас `.` как сокращение алиаса `dssh` или dssh-алиас `:` как сокращение алиаса `ssh-j`. Вместо алиаса `:` можно использовать алиас `.` в этом случае если на хосте dssh-клиента не запущен dssh-сервер то будет использован алиас `:` для доступа к dssh-серверу через посредника ssh-j.com.
- x. отсутствует зачит 127.0.0.1 или локальный IP или локальный алиас: `+` как `0.0.0.0` или `_` как последний сетевой интерфейс.
- host. X или x.
- port50. отсутствует значит 5000 или суффикс порта от 0 до 9 значит порт от 5000 до 5009 или TCP порт.
- port80. суффикс порта от 0 до 9 значит порт от 8000 до 8009 или TCP порт.
1. Вместо PuTTY, plink [0.7](#0.7) для доступа к локальной последовательной консоли на первом USB порту `y` со скоростью 9600 `dssh -U9600` или короче префикс скорости `dssh -U9` или `dssh -UU` или короче `dssh -z`. Можно задать любую стартовую скорость на `y` а потом переключать! На Darwin 12.7.6 тоже работает. Для Linux нужно членство в группе dialout.<div id=1.2>
2. Вместо PuTTY, plink для доступа к локальной последовательной консоли на порту `COM3` для Windows со скоростью 9600 `dssh -HCOM3` или короче суффикс порта `dssh -H3`.<div id=1.3>
3. Вместо PuTTY, plink, `busybox microcom` для доступа к локальной последовательной консоли на порту `/dev/ttyUSB0` со скоростью 9600 `dssh -H/dev/ttyUSB0` или `dssh -HttyUSB0` или короче `dssh -H0`.<div id=1.4>
4. Вместе с PuTTY для доступа к `y` `dssh -u`. На Linux и Darwin используется putty или plink если их нет то `busybox microcom`.<div id=1.5>
5. Вместе с plink для доступа к `y` `dssh -zu`. Ключ `-z` вместе с ключами `-u` или `-Z` значит в том же окне. С Сygwin на Windows 7 как [1.4](#1.4).<div id=1.6>
6. Вместе с telnet для доступа к `y` через telnet://127.0.0.1:5000 `dssh -Z`. Для Windows в новом окне. С Сygwin на Windows 7 как [1.1](#1.1).<div id=1.7>
7. Вместе с telnet для доступа к `y` через telnet://127.0.0.1:5000 `dssh -zZ`. С Сygwin на Windows 7 как [1.1](#1.1).<div id=1.8>
8. В окне веб браузера для доступа к `y` через http&#65279;://127.0.0.1:8008 `dssh -8 8008` или короче суффикс порта `dssh -88`.<div id=1.9>
9. Как в [1.8](#1.8) но через http&#65279;://192.168.1.1:8000 `dssh -8 8000 0.0.0.0` или короче суффикс порта `dssh -80 0.0.0.0` или ещё короче `dssh -80 +`, где 192.168.1.1 это первый сетевой интерфейс или `0.0.0.0`.<div id=1.10>
10. Как в [1.9](#1.9) но через http&#65279;://192.168.2.1:8009 `dssh -8 8009 192.168.2.1` или короче суффикс порта `dssh -89 192.168.2.1` или ещё короче `dssh -89 _`, где 192.168.2.1 это последний сетевой интерфейс.<div id=1.11>
11. Как в [1.9](#1.9) но через telnet://192.168.1.1:5000 `dssh -25000 0.0.0.0` или короче `dssh -20 +`.<div id=1.12>
12. Как в [1.10](#1.10) но через telnet://192.168.2.1:5000 `dssh -25000 192.168.2.1` или короче `dssh -20 _`.<div id=1.13>
13. Когда используется `dssh -20 -88` это всё равно, что совместно `dssh -20` и `dssh -H127.0.0.1:5000 -88` или короче `dssh -H: -88`. Режим посредника.<div id=1.14>
14. Клиент dssh c параметрами `-2 port50 x` работает и как RFC2217 телнет-клиент [1.15](#1.15) и как RFC2217 телнет-сервер типа [ser2net](#0.8) только без команд для модема.<div id=1.15>
15. Клиент dssh с параметрами `-H host:port50` работает как RFC2217 телнет-клиент и может удалённо менять режимы работы последовательной консоли: baudRate - скорость бит/сек, dataBits - количесто бит в данных, parity - чётность, stopBits - количество стоповых бит. По умолчанию это 9600,8,N,1,N. Если host опущен то он 127.0.0.1. Если `-HH` то это как `-H: .`<div id=1.16>
16. Чтоб поделиться локальной последовательной консолью через sshd-сервер `X` `dssh -s20 X` или короче `dssh -s X`. Для подключения к этой консоли `dssh -H127.0.0.1:5000 X` или `dssh -H:5000 X` или `dssh -H: X` или короче `dssh -HH X` или без управления и без перевода консоли в сырой (raw) режим `ssh -W127.0.0.1:5000 X`.<div id=1.17>
17. Чтоб поделиться локальной последовательной консолью через dssh-сервер `dssh -s20 :`, где dssh-алиас `:` вместо `X` из [1.16](#1.16) или короче `dssh -s`. Ключ `-s`это сокращение `-s20 :`. Для подключения к этой консоли `dssh -HH` или без управления `dssh -W5000 .` или без управления и без перевода консоли в сырой режим `ssh -W127.0.0.1:5000 .`. 
18. Чтоб поделиться в LAN локальной последовательной консолью без dssh-сервера и без sshd-сервера `dssh -20` или `dssh -s .`. Для подключения к этой консоли `dssh -H:` или без управления `dssh -W5000` или `telnet 127.0.0.1 5000`. 

# 2. Как использовать для доступа к удалённой консоли интерпретатора команд по ssh:
- X. IP или dns адрес или ssh-алиас или dssh-алиас `.` как сокращение алиаса `dssh` или `:` как сокращение алиаса `ssh-j`.
- x. отсутствует значит 127.0.0.1 или локальный IP или локальный алиас: `+` как в [1.9](#1.9) или `_` как в [1.10](#1.10).
- host. X или x.
- port22. отсутствует значит 2200 или суффикс порта от 0 до 9 значит порт от 2200 до 2209 или TCP порт.
1. При наличии на хосте Сети запускаем dssh-сервер `dssh`. Сервер будет ждать на 127.0.0.1:2200.<div id=2.2>
2. При наличии у клиента Сети подключаемся к dssh-серверу `dssh .` Это сработает и за NAT так как подключение идёт через посредника `ssh-j.com` [0.4](#0.4).<div id=2.3>
3. При отсутствии на хосте Сети запускаем dssh-сервер `dssh +` или `dssh _` или `dssh -d x:port22` и сообщаем клиенту `x:port22`.<div id=2.4>
4. При отсутствии на клиенте Сети но при наличии локальной сети подключаемся к dssh-серверу `dssh -j x:port22`.<div id=2.5>
5. Если клиент находится на хосте с dssh-сервером, подключаемся к нему без посредников `dssh .` или `dssh -j:` или `dssh -j x:port22` или через посредника `dssh :` .<div id=2.6>
6. Так же как в [1.4](#1.4) и [1.5](#1.5) но с параметром `.`. Например вместе с PuTTY `dssh -u .` или вместе c plink `dssh -zu .`. Должно выполняться условие [6.8](#6.8).
7. Вместе с ssh в отдельном окне `dssh -Z .` похоже на [1.6](#1.6) или вместе с ssh в том же окне `dssh -zZ .` похоже на [1.7](#1.7). Должно выполняться условие [6.8](#6.8). C Cygwin на Windows 7 `dssh -Z .` значит `dssh -zZ .`
8. Так же как в [1.8](#1.8)-[1.12](#1.12) но с параметром `-Hcmd` для Windows или `-Hbash` для Linux. Например `dssh -Hcmd -20 .` или короче `dssh -0Hcmd` или через браузер и Linux `dssh -0Hbash -88`.
9. Вместо `ssh X` как `dssh X` и наоборот вместо `dssh :` `dssh -Z :` как `ssh :`  

# 3. Как использовать для доступа к удалённой консоли:<div id=3.1>
- X. IP или dns адрес или алиас sshd-сервера или алиасы dssh-сервера `:`, `.` как сокращения алиасов `ssh-j`, `dssh`.
1. Как в [2.2](#2.2)-[2.6](#2.6) только добавив ключи `-z` `-U` `-H` `-2` `-8` из раздела [1](#1.1). Например `dssh -z .` или `dssh -H3 .`. Это похоже на `dssh . dssh -z` или `ssh -t . dssh -z`. Ключ `-t` переводит консоль в сырой режим. Вариант `dssh -z .` лучше протоколируется, зато вариант `ssh -t X dssh -z` позволяет подключаться и к sshd-серверу `X` и к dssh-серверу.<div id=3.2>
2. Если на 192.168.2.1 запущен RFC2217 телнет-сервер c доступом к последовательной консоли через порт 5000 например `dssh -25000 _` или короче `dssh -20 _` как в [1.12](#1.12) или сервис [ser2net](#0.8) или RouterOS с портом USB и адаптером USB2serial то с 192.168.2.2 можно подключиться `dssh -W192.168.2.1:5000` в сыром режиме без управления режимом последовательной консоли или `dssh -H192.168.2.1:` в режиме RFC2217 c управлением режимом последовательной консоли.
3. Если на 192.168.2.2 запущен dssh-сервер а на 192.168.2.1 запущен RFC2217 телнет-сервер c доступом к последовательной консоли через порт 5000 как в [3.2](#3.2) то можно подключиться без управления режимом консоли `dssh -W192.168.2.1:5000 .` или с управлением`dssh -H192.168.2.1: .`. Как в [3.2](#3.2) только отовсюду.
4. Если на 192.168.2.2 запущен sshd-сервер `X` а на 192.168.2.1 запущен RFC2217 телнет-сервер c доступом к последовательной консоли через порт 5000 как в [3.2](#3.2) то присоединиться к консоли можно `ssh -W192.168.2.1:5000 X` или `dssh -H192.168.2.1: X`.<div id=3.5>
5. Если на хосте запущен dssh-сервер и на нём же запущен RFC2217 телнет-сервер c доступом к последовательной консоли например `dssh -20` то можно подключиться отовсюду `dssh -W127.0.0.1:5000 .` или `dssh -W:5000 .` или `dssh -W5000 .` или `dssh -H127.0.0.1:5000 .` или `dssh -H:5000 .` или `dssh -H: .` или короче `dssh -HH`.
6. Когда используется `dssh -20 .` или короче `dssh -0` или `dssh -88 .` то телнет или веб-сервер запускается на хосте dssh-сервера а порт указанный в `-2` или `-8` переносится локально как `-L`. Управление режимом последовательной консоли по ключу `-8` ведётся не по протоколу RFC2217 а по ssh.
 
# 4. Как использовать для совместного доступа к консоли нескольких клиентов:
1. Запускаем на удалённом хосте dssh-сервер `dssh`.<div id=4.2>
2. Команда `dssh -2 5000 .` или `dssh -20 .` или короче `dssh -0` запускает на хосте с dssh-сервером RFC2217 телнет-сервер с портом 5000. По умолчанию порт 5000 будет подключен к последовательной консоли на первом USB порту со скоростью 9600. Ключами `-H` `-U` можно указать другой последовательный порт и другую стартовую скорость.<div id=4.3>
3. Присоединяемся к консоли на порту 5000 `dssh -H:5000 .` или короче `dssh -HH` или `dssh -20 .` или короче `dssh -0` или с PuTTY `dssh -u0` или c telnet `dssh -Z0` или без управлением режимом консоли `dssh -W5000 .`. Таких подключений может быть несколько.<div id=4.4>
4. Если клиенты находятся на хосте то присоединиться к консоли можно `dssh -20 -j:` или `dssh -20` или `dssh -20 .` или как в [4.3](#4.3).<div id=4.5>
5. Другие клиенты в локальной сети хоста могут присоединиться к консоли `dssh -20 -j host`, где `host` это адрес запущенного dssh-сервера или на Windows `telnet host 5000`.<div id=4.6>
6. Если в пунктах [4.2](#4.2)-[4.5](#4.5) заменить `-20` на `-88` то вместо telnet://host:5000 будет использоваться http&#65279;://host:8008 то есть будет запущен веб-сервер на порту 8008. Например `dssh -8 8008` или `dssh -88`.<div id=4.7>
7. Другие клиенты в локальной сети хоста могут присоединиться к консоли `dssh -88 -j host`. или на Windows `start http://host:8008`, где `host` это адрес запущенного dssh-сервера.
8. Если в [4.2](#4.2)-[4.7](#4.7) добавить ключ `-Hcmd` для Windows или `-Hbash` для Linux или Cygwin то вместо последовательной консоли будет совместно использоваться интерпретатор команд.
9. Если RFC2217 телнет-сервер с портом 5000 запущен на sshd-сервере `X` то подключится к нему можно `dssh -H:0 X` или короче `dssh -0 X`. Если вместо порта 5000 порт 5002 то `dssh -H:2 X`. Если вместо порта 5000 порт 2323 то `dssh -H:2323 X`.

# 5. Как использовать на Windows 7:
- X. IP или dns адрес или ssh алиас.
1. Если есть Cygwin, MSYS2/MINGW, git-bash то как обычно `dssh X`
2. Иначе вместо `dssh X` если есть PuTTY будет запущен `dssh -u X`. Чтобы запустить без PuTTY `dssh -T X` или `dssh -ND:1080 X`.
3. Иначе используем вместе с ssh `dssh -Z X`.
4. Иначе для доступа к локальной консоли через браузер `dssh -88`
5. Иначе для доступа к удалённой консоли через браузер `dssh -088`
6. Иначе для доступа к удалённой консоли интерпретатора команд через браузер для Linux `dssh -Hbash -088` или для Windows `dssh -Hcmd -088`.
7. Иначе чтоб подключиться через браузер к телнет-серверу 192.168.2.1:5000 [3.3](#3.3) через dssh-сервер `dssh -H192.168.2.1:5000 -88 .` или короче `dssh -H192.168.2.1: -88 .`
8. Иначе чтоб подключиться через браузер к телнет-серверу 192.168.2.1:5000 [3.4](#3.4) через sshd-сервер `X` `dssh -H192.168.2.1:5000 -88 X` или короче `dssh -H192.168.2.1: -88 X`.

# 6. Как устроена авторизация:
1. Авторизация основана на вложенном ключе Центра Сертификации `.\internal\ca`. Его можно обновлять запуском `go run cmd/main.go`.
2. Вложение шифруется ключом `.\key.enc`. Его можно удалить а потом создать новый запустив `go run github.com/abakum/embed-encrypt`.
3. Ключ расшифровки вложения извлекается не публикуемой функцией Priv из `internal\tool\tool.go`. Пример такой функции смотри в [eex](https://github.com/abakum/eex/blob/main/public/tool/tool.go).
4. Доступ к экземпляру сервера в пространстве имён посредника ssh-j.com задаётся именем `59d7a68@ssh-j.com` где 59d7a68 это начало хэша комита git смотри `git log -1` или первую строку при запуске `dssh -V` то есть без дополнительный параметров клиент `dssh :` подключится к dssh-серверу через посредника если они одного комита.
5. Для доступа клиента к dssh-серверу другого комита нужно указать имя через ключ `-l` `dssh -l 59d7a68 :`.
6. Врочем вместо начала хэша комита можно использовать что-то попроще например переименовываем файл `dssh` в `ivanov` и посылаем Иванову. Он запускает dssh-сервер `ivanov` а мы подключаемся как `dssh -l ivanov :`.
7. Если Петров умеет запускать программы с параметром то можно и не переименовывать `dssh` в `petroff`. Петров запустит `dssh -l petroff` а мы `dssh -l petroff :`.<div id=6.8>
8. Для доступа к dssh-серверу через `putty`, `plink` или `ssh` важно иметь доступ к агенту ключей с хотя бы одним ключём например `id_rsa` и хоть раз запустить `dssh . exit` чтоб записать сертификат замка в `~/.ssh/id_rsa-cert.pub` и сертификат хоста в `~/.ssh/dssh`. 

# 7. Что было доделанно в tssh:
1. Вывод кастомных сообщения - DebugF и WarningF из login.go.
2. Для красоты - type StringSet из login.go, type afterDo []func() для afterLoginFuncs, onExitFuncs, restoreStdFuncs из main.go.
3. Глобальный конфиг для Windows - initUserConfig из config.go, resolveEtcDir, ExpandEnv в getHostKeyCallback из login.go, config.go.
4. Авторизация хостов по сертификатам - caKeysCallback, caKeys в getHostKeyCallback из cert.go.
5. Авторизация клиентов по сертификатам - addCertSigner, args.Config.GetAllSigner, args.Config.GetAllCASigner, idKeyAlgorithms в getPublicKeysAuthMethod из login.go.
6. Чтение HostKeyAlgorithms - setupHostKeyAlgorithmsConfig из login.go, algo.go. Смотри `ssh -Q HostKeyAlgorithms`.
7. Перенос агента авторизации - getForwardAgentAddr, getAgentClient в sshAgentForward из login.go.
8. Чтение ExitOnForwardFailure - dynamicForward, localForward, remoteForward, sshForward из forward.go .
9. Запуск в Windows7 без Cygwin и MSYS2 через `-T` - setupVirtualTerminal, sttyExecutable из term_windows.go.
10. Чтение IdentitiesOnly в getPublicKeysAuthMethod из login.go.<div id=7.11>
11. Уникальный SecretEncodeKey и подсказка `encPassword bar` при указании `-o Password=foo` в getPasswordAuthMethod из login.go.
12. Возможность прервать dynamicForward, localForward, remoteForward по Ctr-C используя restoreStdFuncs.Cleanup перед ss.client.Wait в sshStart из main.go.
13. Возможность прервать сессию по `<Enter><EscapeChar>.` newTildaReader в wrapStdIO из trzsz.go и newServerWriteCloser в sshLogin из login.go.<div id=7.14>
14. Для системного прокси Windows нужен socks4 поэтому github.com/smeinecke/go-socks5 вместо github.com/armon/go-socks5 в forward.go.
15. goScanHostKeys ищет все ключи хоста для добавки в known_hosts. Есть мнение, что это не безопасно.
16. Чтение KexAlgorithms - setupKexAlgorithmsConfig из login.go, kex.go. Смотри `ssh -Q KexAlgorithms`.
17. Исправлена опечатка в keepAlive
18. makeStdinRaw для stdioForward в sshStart.

# 8. Как ещё можно использовать dssh:
1. Если запустить на хосте `dssh` и проверив доступ `dssh :` потом к хосту можно подключиться для удалённой разработки через `Remote - SSH extension` выбрав алиас `ssh-j` или ":" в `Connect to Host`.
2. Благодаря tssh [0.1](#0.1) можно прописать в `~/.ssh/config` после `Host proxy` `encPassword bar` и `DynamicForward 127.0.0.1:1080` чтоб не вводить пароль при запуске `dssh -5 proxy` для использования Socks5 прокси [7.11](#7.11). Чтоб `ssh` не ругался на неизвестный параметр `encPassword` в начале `~/.ssh/config` вставьте `IgnoreUnknown *`
3. Для системного прокси на Windows нужен Socks4 прокси поэтому `dssh proxy` [7.14](#7.14).
4. В [4.11](#4.11) можно вместо интерпретатора команд указывать команду или посредника. Например `dssh -Htop .` это почти то же что и `dssh -t . top`. Вот только значение ключа `-H` если не содержит ` ` или `:` не должно заканчиваться на цифру - иначе это будет принято за порт последовательной консоли. Например вместо `dssh -Htest2 .` надо `dssh -H"test2 " .` Если в значение ключа `-H` есть пробелы то пробел в конец можно не добавлять. Например `dssh -H"ping 8.8.8.8"`. Если в значение ключа `-H` есть `:` то это посредник и может заканчиваться на цифру.
5. Команды с `-Hcmd` или `-Hbash` можно использовать для отладки когда на хосте нет последовательно порта.
6. Можно использовать `dssh` как посредника: Если у клиента `AX` есть доступ к телнет-серверу по адресу host:port и доступ к sshd-серверу `X` то отдаём эту консоль через `X` `dssh -Hhost:port -20 X` или короче `dssh -sHhost:port X` если у клиента `BXBY` есть доступ к sshd-серверам `X` и `Y` то используем её `dssh -HH X` или заходим на `X` `dssh X` и передаём её на `Y` `dssh -sHH Y` или короче `dssh -t X dssh -sHH Y` если у клиента `СY` есть доступ к sshd-серверу `Y` то используем её `dssh -HH Y`. Все команды управления режимом последовательной консоли передаются по цепочке посредников. Вместо последовательной консоли может быть консоль интерпретатора команд. Вместо sshd-серверов могут быть dssh-сервера: Если у клиента `A` есть доступ к телнет-серверу по адресу host:port и доступ к dssh-серверу то отдаём эту консоль `dssh -sH host:port` если у клиента `BY` есть доступ к dssh-серверу и к sshd-серверу `Y` то используем её `dssh -HH` или передаём её на `Y` `dssh . dssh -sHH Y` если у клиента `СY` есть доступ к sshd-серверу `Y` то используем её `dssh -HH Y`.
7. Можно использовать `dssh` в качестве посредника в `~/.ssh/config` `ProxyCommand dssh -W %h:%p .` как `ProxyCommand ssh -W %h:%p ssh-j`. Например `dssh -J ssh-j X` как `Host X` и `ProxyCommand dssh -W %h:%p .`
8. Если для `Host overSocks5` указать `ProxyCommand plink -load %n -raw %h -P %p` и `ProxyPutty socks5://127.0.0.1:1080` то в `PuTTY\Sessions\overSocks5` будет записано, `ProxyMethod=2` `ProxyHost=127.0.0.1` `ProxyPort=1080` и `plink` сделает то же что и `ProxyCommand nc -X 5 -x 127.0.0.1:1080 %h %p` или `ProxyCommand connect -S 127.0.0.1:1080 %h %p` [ssh-connect](https://github.com/gotoh/ssh-connect). Можно задать и `ProxyPutty socks4://host[:port]` как `ProxyCommand nc -X 4 -x host[:port] %h %p` и `ProxyPutty socks4a://host[:port]` и `ProxyPutty http://host[:port]` как `ProxyCommand nc -X connect -x host[:port] %h %p` и `ProxyPutty ${http_proxy}`. Если в `Host overSocks5` указан `ProxyPutty` то PuTTY не будет использовать `ProxyCommand` а ssh будет.
Можно отдельно указать для `Host D1080` `ProxyPutty socks5://127.0.0.1:1080` а для `Host overSocks5` `ProxyCommand plink -load D1080 -raw %h -P %p`. Приятно, что это сработает и на Windows и на Linux если установлен plink.
9. Можно использовать `dssh` в качестве посредника `socks5://127.0.0.1:1080` как `dssh -45ND1080 .`
10. Чтоб перезапустить dssh-сервер используйте ключ `-r` или `--restart`. Сервер остановится и запустится через 15 секунд.
11. Чтоб остановить dssh-сервер используйте ключ `--exit`.

# 9. Удалённый доступ к последовательной консоли на хосте с [RouterOS](#0.10) или с [ser2net](#0.8) или с [hub4com](#0.9):
1. Подключаем USB2serial переходник в USB порт устройства под управлением RouterOS.
2. Запускаем удалённый доступ к последовательной консоли RouterOS `/port remote-access add port=usb1 tcp-port=5000 protocol=raw` [Ports](https://help.mikrotik.com/docs/spaces/ROS/pages/8978525/Ports). Для смены режима на консоле `/port set 0 flow-control=none stop-bits=1 parity=none baud-rate=9600` `/port set 0 baud-rate=auto`
3. Если LAN dssh-сервера это 192.168.0.1 а у устройства с RouterOS LAN это 192.168.0.2 то подключаемся `dssh -W192.168.0.2:5000 .` или `dssh . dssh -W192.168.0.2:5000`. Это похоже на `ssh -W192.168.0.2:5000 ssh-j` только ssh не переводит консоль в сырой режим а dssh переводит.
4. Иначе разрешим доступ с WAN на 22 порт tcp `/ip firewall filter add action=accept chain=input dst-port=22 protocol=tcp` для доступа по SSH с WAN.
 И разрешим доступ с lo по tcp `/ip firewall filter add action=accept chain=input in-interface=lo protocol=tcp` для туннеля с WAN на 5000 порт. (80 для управления по webfig, 8291 по winbox) 
5. Если алиас RouterOS это X то подключаемся `dssh -W5000 X`.
6. Останавливаем удалённый доступ к последовательной консоли RouterOS `/port remote-access remove 0` 
7. Для возможности смены клиентом режима удалённой последовательной консоли через протокол RFC2217 запускаем аналог [ser2net](#0.8) на RouterOS `/port remote-access add port=usb1 tcp-port=5000`
8. Если LAN хоста с запущенными `dssh` это 192.168.0.1 а у устройства с RouterOS LAN это 192.168.0.2 то подключаемся `dssh -H192.168.0.2:5000 .` или короче `dssh -H192.168.0.2: .`.<div id=9.9>
9. Если алиас RouterOS это `X` то подключаемся `dssh -H127.0.0.1:5000 X` или `dssh -H: X` или короче `dssh -0 X` это то же что и `dssh -NL127.0.0.1:5000:127.0.0.1:5000 X` а потом `dssh -H:`.
10. Если запустить `ssh -NL127.0.0.1:5000:127.0.0.1:5000 X` то `dssh -H:` сработает только однажды потому, что после закрытия `dssh -H:` статус `/port remote-access` останется подключенным. Это особенность ssh.
11. Если алиас хоста с sshd-сервером `X` и на нём запущен `ser2net -C "5000:telnet:0:/dev/ttyUSB1:115200 8DATABITS NONE 1STOPBIT LOCAL -XONXOFF remctl"` или [hub4com](#0.9) как `com2tcp-rfc2217 com1 5000` типа `dssh -H1 -20 +` то подключаемся `dssh -H127.0.0.1:5000 X` или `dssh -H: X` или короче `dssh -0 X`. 
12. Если на хосте с dssh-сервером запущен `ser2net -C "127.0.0.1,5000:telnet:0:/dev/ttyUSB1:115200 8DATABITS NONE 1STOPBIT LOCAL -XONXOFF remctl"` или [hub4com](#0.9) как `com2tcp-rfc2217 --interface 127.0.0.1 com1 5000` типа `dssh -H1 -20` то подключаемся `dssh -H127.0.0.1:5000 .` или `dssh -H: .` или короче `dssh -0`. 
13. Если [ser2net](#0.8) или [hub4com](#0.9) доступен по LAN как `x` и на нём запущен `ser2net -C "x,5000:telnet:0:/dev/ttyUSB1:115200 8DATABITS NONE 1STOPBIT LOCAL -XONXOFF remctl"` или `com2tcp-rfc2217 --interface x com1 5000` типа `dssh -H1 -20 x` то подключаемся `dssh -Hx:5000` или `dssh -Hx:`. 

# 10. Параметры для локального доступа:
- x. отсутствует или локальный IP или локальный алиас: `+` как в [1.9](#1.9) или `_` как в [1.10](#1.10).
- y. локальная последовательная консоль на первом свободном порту USB.
- host. любой IP или адрес хоста или x.
- port50. отсутствует или суффикс от 0 до 9 или TCP порт. Если port50 отсутствует то он 5000. Если суффикс от 0 до 9 то порт от 5000 до 5009.<div id=10.1>
1. `-z` то же что и `-U 9600` как в [1.1](#1.1).<div id=10.2>
2. `-20 x` то же что `-U 9600` + стартует RFC2217 телнет-сервер на `x:5000` как в [1.11](#1.11) + стартует RFC2217 телнет-клиент в том же окне.<div id=10.3>
3. `-ZH host:port50` то же что и `telnet -e^Q host port50` для Windows в новом окне как в [1.6](#1.6). Для Cygwin на Windows7 или Linux в том же окне.<div id=10.4>
4. `-Z20 x` то же что и `-20 x` + `telnet -e^Q x 5000` для Windows в новом окне. Для Cygwin на Windows7 или Linux в том же окне.<div id=10.5>
5. `-Z x` как в [10.4](#10.4).<div id=10.6>
6. `-zZ x` то же что и `-20 x` + `telnet -e^Q x 5000` в том же окне и без управлением режимом консоли.<div id=10.7>
7. `-u20 x` то же что и `-20 x` + `putty -telnet x -P 5000` как в [1.4](#1.4).<div id=10.8>
8. `-u` то же что и `putty -serial y -sercfg 9600,8,1,N,N` и без управлением режимом консоли.<div id=10.9>
9. `-zu` то же что и `plink -serial y -sercfg 9600,8,1,N,N` и без управлением режимом консоли. Для Cygwin на Windows7 `putty -serial y -sercfg 9600,8,1,N,N`.<div id=10.10>
10. `-uH host:port50` то же что и `putty -telnet host -P port50` как в [1.4](#1.4).<div id=10.11>
11. `-88 x` то же что `-U 9600` + стартует веб-сервер на `x:8008` + `chrome http://x:8008`.<div id=10.12>
12. `-22 -88 x` то же что `-U 9600` + стартует RFC2217 телнет-сервер на `x:5002` + стартует веб-сервер на `x:8008` + `chrome http://x:8008`

# 11. Параметры для удалённого доступа:
- X. внешний IP или dns адрес или ssh алиас.
- Y. удалённая последовательная консоль на первом свободном порту USB.
- host. любой IP или dns адрес хоста или x.
- port50. отсутствует или суффикс от 0 до 9 или TCP порт. Если port50 отсутствует то он 5000. Если суффикс от 0 до 9 то порт от 5000 до 5009.<div id=11.1>
1. `-z .` как в [10.1](#10.1) только на хосте с `dssh`. Как `ssh : dssh -z`.<div id=11.2>
2. `-20 .` или короче `-0` как в [10.2](#10.2) только на хосте с `dssh` + 127.0.0.1:5000 переносится локально как `-L` на 127.0.0.1:5000 сервера.<div id=11.3>
3. `-H host:port50 .` то же что и `dssh -W host:port50 .` только с управлением по RFC2217 или RFC1073 как в [3.5](#3.5).<div id=11.4>
4. `-Z20 .` или короче `-Z0` то же что и `-20 .` как в [11.2](#11.2) + `telnet -e^Q 127.0.0.1 5000` учитывая перенос портов управление будет консолью на хосте сервера.<div id=11.5>
5. `-Z X` то же что и `ssh X` для Windows новом окне.<div id=11.6>
6. `-zZ X` то же что и `ssh X` для Windows в том же окне.<div id=11.7>
7. `-u20 .` или короче `-u0` то же что и `-20 .` + `putty -telnet 127.0.0.1 -P 5000` учитывая перенос портов управление будет консолью на хосте сервера.<div id=11.8>
8. `-u X` то же что и `putty @X` для Windows новом окне как в [1.4](#1.4). Для Linux то же что и `plink -load X`. Перед стартом putty алиас X создаётся из ssh алиаса X.<div id=11.9>
9. `-zu X` то же что и `plink -load X` как в [11.8](#11.8).<div id=11.10>
10. `-s .` как в [10.2](#10.2).<div id=11.11>
11. `-88 .` то же что `-U 9600` + стартует веб-сервер на хосте dssh-сервера `127.0.0.1:8008` + локальный порт 127.0.0.1:8008 переносится на порт 127.0.0.1:8008 сервера + `chrome http://127.0.0.1:8008` учитывая перенос портов управление консолью будет на хосте сервера.<div id=11.12>
12. `-22 -88 .` или короче `-088` то же что `-U 9600` + 127.0.0.1:5000 и 127.0.0.1:8008 переносятся на 127.0.0.1:5000 и 127.0.0.1:8008 сервера + стартует RFC2217 телнет-сервер на `127.0.0.1:5000` + стартует веб-сервер на `127.0.0.1:8008` + `chrome http://127.0.0.1:8008` учитывая перенос портов управление консолью будет на хосте сервера.<div id=11.13>
13. `-s20 X` или короче `-s X` как в [10.2](#10.2) + 127.0.0.1:5000 sshd-сервера X переносится как `-R` на 127.0.0.1:5000 локального телнет-сервера с RFC2217. Это работает не только c dssh-сервером.<div id=11.14>
14. `-H host:port50 X` 127.0.0.1:port50 переносится sshd-сервером X на host:port50 + локальный телнет-клиент по RFC2217 управляет через sshd-сервер X телнет-сервером с RFC2217 на host:port50 как в [9.9](#9.9). Это работает не только c dssh-сервером. Отданная как в [11.3](#11.3) через sshd-сервер X консоль может использоваться как в [11.4](#11.4) так и [11.2](#11.2).<div id=11.15>
15. `-s20 .` как в [10.2](#10.2).
16. `dssh -t X dssh -22` или `ssh -t X dssh -22` как [11.2](#11.2) только через sshd-сервер `X`.

# 12. Что делать если запутались в параметрах.
1. Читать исходники. Иногда исходники и коментарии понятней руководств.

# 13. Что делать если запутались в исходниках.
1. Писать свою программу тщательно комментировать её и писать руководства. \8^)
